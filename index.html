<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#3b82f6">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="manifest.json">
<title>Command Center</title>
<style>
:root{--bg:#fafaf8;--text:#1a1a1a;--muted:#6b7280;--border:#e5e5e3;--blue:#3b82f6;--bl:#dbeafe;--green:#22c55e;--gl:#dcfce7;--orange:#f97316;--ol:#ffedd5;--purple:#8b5cf6;--pl:#ede9fe;--pink:#ec4899;--pkl:#fce7f3;--red:#ef4444;--rl:#fee2e2;--yellow:#eab308;--yl:#fef9c3;--card:#fff;--sh:0 1px 3px rgba(0,0,0,.08)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Georgia,'Times New Roman',serif;background:var(--bg);color:var(--text);font-size:15px;line-height:1.6}
h1{font-size:1.4em;font-weight:600}h2{font-size:1.2em;margin-bottom:10px;font-weight:600}h3{font-size:1.05em;margin-bottom:8px;font-weight:600}
button{cursor:pointer;font-family:inherit}input,textarea,select{font-family:inherit;font-size:inherit}
.nav{display:flex;border-bottom:2px solid var(--border);background:var(--card);position:sticky;top:0;z-index:100;overflow-x:auto}
.nav button{padding:10px 14px;border:none;background:none;font-size:13px;color:var(--muted);border-bottom:2px solid transparent;margin-bottom:-2px;white-space:nowrap}
.sync-bar{display:flex;align-items:center;gap:8px;padding:6px 14px;background:var(--card);border-bottom:1px solid var(--border);font-size:12px}
.sync-bar input{padding:5px 8px;border:1px solid var(--border);border-radius:4px;font-size:12px;width:180px}
.sync-bar button{padding:4px 10px;border:1px solid var(--border);border-radius:4px;font-size:11px;background:var(--card);cursor:pointer}
.sync-bar .btn-sync{background:var(--blue);color:#fff;border-color:var(--blue)}
.sync-bar .btn-disc{background:var(--red);color:#fff;border-color:var(--red);font-size:10px}
.nav button.active{color:var(--text);border-bottom-color:var(--blue);font-weight:600}
.nav button:hover{background:var(--bl)}
.tab{display:none;max-width:880px;margin:0 auto;padding:20px 16px}.tab.active{display:block}
.card{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:16px;margin-bottom:14px;box-shadow:var(--sh)}
.label{display:inline-block;padding:2px 7px;border-radius:4px;font-size:11px;font-weight:600}
.l-work{background:var(--bl);color:var(--blue)}.l-gym{background:var(--gl);color:var(--green)}.l-ital{background:var(--ol);color:var(--orange)}.l-diss{background:var(--pl);color:var(--purple)}.l-social{background:var(--pkl);color:var(--pink)}.l-misc{background:var(--yl);color:var(--yellow)}
.tblock{display:flex;border-left:3px solid var(--border);padding:7px 12px;margin:3px 0;border-radius:0 4px 4px 0;font-size:14px}
.tblock .tm{min-width:85px;font-weight:600;color:var(--muted);font-size:13px}
.tblock.work{border-left-color:var(--blue);background:var(--bl)}.tblock.gym{border-left-color:var(--green);background:var(--gl)}.tblock.italian{border-left-color:var(--orange);background:var(--ol)}.tblock.dissertation{border-left-color:var(--purple);background:var(--pl)}.tblock.social{border-left-color:var(--pink);background:var(--pkl)}
.hrow{display:flex;align-items:flex-start;gap:10px;padding:9px 0;border-bottom:1px dashed var(--border)}.hrow:last-child{border-bottom:none}
.hchk{width:20px;height:20px;flex-shrink:0;margin-top:2px;accent-color:var(--green)}
.hinfo{flex:1}.hname{font-weight:600;font-size:13px}.hdet{font-size:12px;color:var(--muted)}
.hev{margin-top:5px}.hev input,.hev textarea{width:100%;padding:5px 8px;border:1px solid var(--border);border-radius:4px;font-size:13px}.hev textarea{min-height:50px;resize:vertical}
.ewarn{color:var(--red);font-size:11px;font-weight:600;display:none}
.timer-d{font-size:2.8em;font-family:'Courier New',monospace;text-align:center;padding:16px;letter-spacing:3px}
.timer-c{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
.timer-c button{padding:7px 18px;border:1px solid var(--border);border-radius:6px;background:var(--card);font-size:13px}
.timer-c .pri{background:var(--blue);color:#fff;border-color:var(--blue)}.timer-c .dan{background:var(--red);color:#fff;border-color:var(--red)}
.timer-c button:disabled{opacity:.4;cursor:not-allowed}
.sgrid{display:grid;grid-template-columns:repeat(7,1fr);gap:3px;max-width:280px}
.scell{width:100%;aspect-ratio:1;border-radius:3px;background:#eee}.scell.done{background:var(--green)}.scell.partial{background:var(--yellow)}.scell.today{outline:2px solid var(--blue);outline-offset:1px}
.iinput{display:flex;gap:8px;margin-bottom:14px}.iinput input{flex:1;padding:9px 11px;border:1px solid var(--border);border-radius:6px;font-size:14px}.iinput button{padding:9px 14px;background:var(--blue);color:#fff;border:none;border-radius:6px}
.iitem{display:flex;align-items:center;gap:8px;padding:8px;border:1px solid var(--border);border-radius:6px;margin-bottom:5px;background:var(--card);font-size:13px}
.iitem .itxt{flex:1}.iitem select,.iitem button{padding:3px 7px;border:1px solid var(--border);border-radius:4px;font-size:11px;background:none}.iitem .del{color:var(--red);border-color:var(--red)}
.lentry{padding:7px 10px;border-left:3px solid var(--border);margin:3px 0;font-size:12px;background:#fafafa}
.lentry .lt{color:var(--muted);font-size:10px;font-family:monospace}
.lentry.action{border-left-color:var(--blue)}.lentry.warning{border-left-color:var(--orange)}.lentry.sealed{border-left-color:var(--red);background:var(--rl)}.lentry.confession{border-left-color:var(--purple);background:var(--pl)}
.pgb{background:linear-gradient(135deg,var(--pl),var(--pkl));border:2px solid var(--purple);border-radius:8px;padding:14px;margin-bottom:14px}
.pgb h3{color:var(--purple)}
.rarea textarea{width:100%;min-height:140px;padding:11px;border:1px solid var(--border);border-radius:6px;font-size:14px;line-height:1.7;resize:vertical}
.wc{font-size:11px;color:var(--muted);text-align:right;margin-top:3px}.wc.bad{color:var(--red);font-weight:600}
.chatc{border:1px solid var(--border);border-radius:8px;overflow:hidden}
.chatm{max-height:350px;overflow-y:auto;padding:14px;background:#fafafa}
.cmsg{margin-bottom:10px}.cmsg.user{text-align:right}
.cmsg .bbl{display:inline-block;max-width:80%;padding:7px 12px;border-radius:11px;font-size:13px;text-align:left}
.cmsg.user .bbl{background:var(--blue);color:#fff;border-bottom-right-radius:3px}
.cmsg.ai .bbl{background:var(--card);border:1px solid var(--border);border-bottom-left-radius:3px}
.chatia{display:flex;gap:8px;padding:10px;background:var(--card);border-top:1px solid var(--border)}
.chatia input{flex:1;padding:7px 10px;border:1px solid var(--border);border-radius:6px;font-size:13px}
.chatia button{padding:7px 14px;background:var(--blue);color:#fff;border:none;border-radius:6px;font-size:13px}
.apikey{margin-bottom:14px;padding:10px;background:var(--yl);border-radius:8px;font-size:13px}
.apikey input{width:100%;padding:7px;border:1px solid var(--border);border-radius:4px;font-family:monospace;font-size:12px;margin-top:4px}
.intention{padding:7px 10px;background:var(--yl);border-left:3px solid var(--yellow);margin:3px 0;border-radius:0 4px 4px 0;font-size:12px;font-style:italic}
.bundle{padding:7px 10px;background:var(--gl);border-left:3px solid var(--green);margin:3px 0;border-radius:0 4px 4px 0;font-size:12px}
.pbar{width:100%;height:10px;background:#eee;border-radius:5px;overflow:hidden;margin:3px 0}
.pfill{height:100%;background:var(--purple);border-radius:5px;transition:width .3s}

/* ===== DAY CALENDAR ===== */
.cal-header{display:flex;align-items:center;justify-content:center;gap:10px;padding:8px 0;font-size:14px;cursor:pointer;user-select:none;-webkit-user-select:none;border-bottom:1px solid var(--border);position:relative}
.cal-header:hover{background:#fafafa}
.cal-header .cal-toggle{position:absolute;right:8px;font-size:12px;color:var(--muted);transition:transform .2s}
.cal-header .cal-toggle.collapsed{transform:rotate(-90deg)}
.cal-body{transition:max-height .3s ease,opacity .2s ease;overflow:hidden}
.cal-body.collapsed{max-height:0!important;opacity:0;pointer-events:none}
.cal-wrap{position:relative;height:1020px;overflow-y:auto;border-top:none;background:#fff;user-select:none;-webkit-user-select:none}
.cal-grid{position:relative;margin-left:52px;height:1020px}
.cal-hour-label{position:absolute;left:0;width:48px;text-align:right;font-size:11px;color:var(--muted);font-family:monospace;padding-right:6px;transform:translateY(-7px);pointer-events:none;z-index:2}
.cal-hour-line{position:absolute;left:52px;right:0;height:1px;background:var(--border);pointer-events:none;z-index:1}
.cal-quarter-line{position:absolute;left:52px;right:0;height:1px;background:#f0f0ee;pointer-events:none;z-index:0}
.cal-now-line{position:absolute;left:44px;right:0;height:2px;background:var(--red);z-index:15;pointer-events:none}
.cal-now-line::before{content:'';position:absolute;left:0;top:-4px;width:10px;height:10px;border-radius:50%;background:var(--red)}
.cal-block{position:absolute;left:4px;right:4px;border-radius:5px;padding:4px 8px;font-size:12px;cursor:pointer;z-index:10;overflow:hidden;border-left:3px solid;transition:box-shadow .15s}
.cal-block:hover{box-shadow:0 2px 8px rgba(0,0,0,.15);z-index:12}
.cal-block .cb-title{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cal-block .cb-desc{font-size:10px;opacity:.65;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cal-block .cb-time{font-size:10px;opacity:.7}
.cal-block .cb-recur{position:absolute;top:3px;right:5px;font-size:10px;opacity:.5}
.cal-block.work{background:var(--bl);border-left-color:var(--blue);color:#1e40af}
.cal-block.gym{background:var(--gl);border-left-color:var(--green);color:#166534}
.cal-block.italian{background:var(--ol);border-left-color:var(--orange);color:#9a3412}
.cal-block.dissertation{background:var(--pl);border-left-color:var(--purple);color:#5b21b6}
.cal-block.social{background:var(--pkl);border-left-color:var(--pink);color:#9d174d}
.cal-block.misc{background:var(--yl);border-left-color:var(--yellow);color:#854d0e}
.cal-drag-preview{position:absolute;left:4px;right:4px;border-radius:5px;background:rgba(59,130,246,.15);border:2px dashed var(--blue);z-index:8;pointer-events:none}
.cal-resize-handle{position:absolute;bottom:0;left:0;right:0;height:6px;cursor:s-resize;z-index:11}
.cal-resize-handle:hover{background:rgba(0,0,0,.1);border-radius:0 0 5px 5px}

/* Calendar popover */
.cal-popover{position:fixed;z-index:200;background:var(--card);border:1px solid var(--border);border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,.18);padding:16px;width:300px;font-size:13px}
.cal-popover .cp-row{margin-bottom:10px}
.cal-popover .cp-row label{display:block;font-weight:600;font-size:11px;color:var(--muted);margin-bottom:3px;text-transform:uppercase;letter-spacing:.5px}
.cal-popover .cp-row input,.cal-popover .cp-row select{width:100%;padding:7px 9px;border:1px solid var(--border);border-radius:5px;font-size:13px}
.cal-popover .cp-time-row{display:flex;gap:8px;align-items:center}
.cal-popover .cp-time-row input{width:auto;flex:1}
.cal-popover .cp-time-row span{color:var(--muted);font-size:12px}
.cal-popover .cp-cats{display:flex;gap:4px;flex-wrap:wrap}
.cal-popover .cp-cat{padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;cursor:pointer;border:2px solid transparent;opacity:.6;transition:all .15s}
.cal-popover .cp-cat:hover{opacity:.85}
.cal-popover .cp-cat.sel{opacity:1;border-color:currentColor}
.cal-popover .cp-recur-opts{margin-top:6px;display:flex;gap:4px;flex-wrap:wrap}
.cal-popover .cp-recur-opt{padding:3px 8px;border-radius:10px;font-size:10px;cursor:pointer;background:#f3f4f6;border:1px solid var(--border)}
.cal-popover .cp-recur-opt.sel{background:var(--blue);color:#fff;border-color:var(--blue)}
.cal-popover .cp-actions{display:flex;gap:6px;justify-content:flex-end;margin-top:12px}
.cal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;z-index:199;background:transparent}
.rprompt{margin-bottom:10px}.rprompt label{display:block;font-weight:600;margin-bottom:3px;font-size:13px}
.rprompt textarea{width:100%;min-height:70px;padding:7px;border:1px solid var(--border);border-radius:4px;resize:vertical;font-size:13px}
.atable{width:100%;border-collapse:collapse;font-size:12px;margin:10px 0}
.atable th,.atable td{border:1px solid var(--border);padding:5px 8px;text-align:left}.atable th{background:#f5f5f5;font-weight:600}
@media(max-width:600px){
.nav button{padding:7px 9px;font-size:11px}
.timer-d{font-size:2em}
.tblock{flex-direction:column}.tblock .tm{min-width:auto}
.cal-hour-label{width:36px;font-size:9px;padding-right:3px}
.cal-grid{margin-left:40px}
.cal-hour-line{left:40px}
.cal-quarter-line{left:40px}
.cal-now-line{left:32px}
.cal-block{left:2px;right:2px;padding:3px 5px;font-size:11px}
.cal-block .cb-time{font-size:9px}
.cal-block .cb-desc{font-size:9px}
.cal-popover{left:5px!important;right:5px!important;width:auto!important;max-width:100vw}
}
.flex{display:flex;gap:8px}.flex-1{flex:1}
.btn{padding:6px 12px;border:1px solid var(--border);border-radius:4px;background:var(--card);font-size:13px}
.btn-p{background:var(--blue);color:#fff;border-color:var(--blue)}.btn-d{background:var(--red);color:#fff;border-color:var(--red)}
.btn-s{background:var(--bl);font-size:12px;padding:5px 10px}
.mt8{margin-top:8px}.mb8{margin-bottom:8px}.mb4{margin-bottom:4px}
.fin{padding:6px 8px;border:1px solid var(--border);border-radius:4px;font-size:13px;width:100%}
/* Translation tab */
.tr-table{width:100%;border-collapse:collapse;font-size:14px;line-height:1.7}
.tr-table td{padding:10px 12px;border-bottom:1px solid var(--border);vertical-align:top}
.tr-table td:first-child{border-right:1px solid var(--border)}
.tr-table thead th{padding:8px 12px;font-size:12px;text-transform:uppercase;letter-spacing:.5px;color:var(--muted);border-bottom:2px solid var(--border)}
.tr-table thead th:first-child{border-right:1px solid var(--border)}
.tr-table tbody tr:hover{background:#fafaf8}
.tr-table .it-col{cursor:text;position:relative}
.tr-sel-popup{position:fixed;z-index:300;background:var(--card);border:1px solid var(--border);border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,.15);padding:12px;width:280px;font-size:13px}
.tr-sel-popup input{width:100%;padding:6px 8px;border:1px solid var(--border);border-radius:4px;font-size:13px;margin-bottom:6px}
.tr-card-item{display:flex;align-items:center;gap:8px;padding:6px 8px;border:1px solid var(--border);border-radius:6px;margin-bottom:4px;background:var(--card);font-size:13px}
.tr-card-item .front{font-weight:600;flex:1}.tr-card-item .back{color:var(--muted);flex:1}
</style>
</head>
<body>
<div class="sync-bar" id="sync-bar">
<span id="sync-status">âšª <span style="font-size:11px">Local only</span></span>
<span style="color:var(--muted)">|</span>
<input type="password" id="sync-pass" placeholder="Sync passphrase...">
<button class="btn-sync" onclick="doSync()">Sync</button>
<button class="btn-disc" onclick="doDisconnect()" style="display:none" id="sync-disc">Disconnect</button>
</div>
<nav class="nav" id="nav">
<button class="active" onclick="switchTab('today')">ğŸ“… Today</button>
<button onclick="switchTab('week')">ğŸ“Š Week</button>
<button onclick="switchTab('habits')">ğŸ”¥ Habits</button>
<button onclick="switchTab('dissertation')">ğŸ“ Dissertation</button>
<button onclick="switchTab('inbox')">ğŸ“¥ Inbox</button>
<button onclick="switchTab('focus')">ğŸ”’ Focus</button>
<button onclick="switchTab('cards')">ğŸƒ Cards</button>
<button onclick="switchTab('translate')">ğŸ‡®ğŸ‡¹ Read</button>
<button onclick="switchTab('claude')">ğŸ¤– Claude</button>
<button onclick="switchTab('log')">ğŸ“‹ Log</button>
</nav>

<!-- TODAY -->
<div class="tab active" id="tab-today">
<h1 id="today-date"></h1>
<p style="color:var(--muted);font-size:12px;margin-bottom:14px" id="today-label"></p>
<div class="pgb" id="pgb" style="display:none"><h3>ğŸ¯ Push Goal This Week</h3><p id="pg-text"></p><p style="font-size:11px;color:var(--muted)" id="pg-countdown"></p></div>
<div class="card"><h3>âš¡ Implementation Intentions</h3><div id="int-list"></div><div class="flex mt8"><input class="fin flex-1" id="int-in" placeholder="When X, I will Y..." onkeydown="if(event.key==='Enter')addInt()"><button class="btn-s btn" onclick="addInt()">Add</button></div></div>
<div style="display:flex;gap:14px;flex-wrap:wrap;align-items:flex-start">
<div class="card" style="flex:0 0 40%;min-width:280px"><h3>ğŸ¯ Top 3 Priorities</h3><div id="top3"></div><div class="flex mt8"><input class="fin flex-1" id="t3-in" placeholder="Priority..." onkeydown="if(event.key==='Enter')addT3()"><button class="btn btn-s" onclick="addT3()">Add</button></div></div>
<div class="card" style="flex:1;min-width:300px"><div id="cal-container"></div><div class="flex mt8" style="justify-content:center;gap:6px"><button class="btn btn-s" onclick="exportICS()">ğŸ“¤ Export to Outlook (.ics)</button><label class="btn btn-s" style="display:inline-block;cursor:pointer">ğŸ“¥ Import .ics <input type="file" accept=".ics" onchange="importICS(event)" style="display:none"></label></div></div>
</div>
<div class="card"><h3>ğŸ‡®ğŸ‡¹ Italian Work</h3>
<div style="display:flex;align-items:center;gap:18px;flex-wrap:wrap;padding:8px 0">
<label style="display:flex;align-items:center;gap:6px;font-size:14px"><input type="checkbox" class="hchk" id="h-anki" disabled style="pointer-events:none"><b>Anki</b> â€” <span id="anki-ct" style="font-weight:700">0</span> / <span id="anki-target">0</span></label>
<label style="display:flex;align-items:center;gap:6px;font-size:14px"><input type="checkbox" class="hchk" id="h-art1" disabled style="pointer-events:none"><b>Article 1</b></label>
<label style="display:flex;align-items:center;gap:6px;font-size:14px"><input type="checkbox" class="hchk" id="h-art2" disabled style="pointer-events:none"><b>Article 2</b></label>
</div>
<div class="ewarn" id="anki-w" style="display:none">âš  Less than 300 â€” doesn't count</div>
<input type="hidden" id="anki-ct-val"><input type="hidden" id="art1-t"><input type="hidden" id="art1-th"><input type="hidden" id="art2-t"><input type="hidden" id="art2-th"><span id="art1-status" style="display:none"></span><span id="art2-status" style="display:none"></span>
<hr style="border:none;border-top:1px dashed var(--border);margin:10px 0">
<h3 style="margin-bottom:6px">ğŸ“ Riflessione Giornaliera</h3>
<p style="font-size:12px;color:var(--muted);margin-bottom:6px">Write in Italian. Any format. Min 200 words. Submitted to Claude for correction + Anki cards.</p>
<div class="rarea"><textarea id="refl-txt" placeholder="Scrivi qui in italiano..." onkeyup="updRC()"></textarea></div>
<div class="wc" id="refl-wc">0 / 200 words</div>
<div class="flex mt8"><button class="btn btn-p" onclick="submitRefl()">Submit for Correction + Cards</button></div>
<div id="refl-res" style="display:none" class="mt8"></div>
<div id="refl-card-review" style="display:none;margin-top:10px" class="card"></div>
</div>
<div class="card"><h3>ğŸ”— Temptation Bundles</h3><div id="bun-list"></div><div class="flex mt8"><input class="fin flex-1" id="bun-in" placeholder="I only get [X] during/after [Y]..." onkeydown="if(event.key==='Enter')addBun()"><button class="btn btn-s" onclick="addBun()">Add</button></div></div>
<div class="card"><h3>ğŸ“¥ Quick Capture</h3><div class="iinput"><input id="qcap" placeholder="Capture a thought or task..." onkeydown="if(event.key==='Enter')qCapture()"><button onclick="qCapture()">Capture</button></div></div>
<div class="card" style="text-align:center"><button class="btn btn-d" onclick="sealDay()">ğŸ”’ Seal Today (Cannot Undo)</button><p style="font-size:11px;color:var(--muted);margin-top:4px">Locks all entries for today. Auto-seals at midnight.</p></div>
</div>

<!-- WEEK -->
<div class="tab" id="tab-week">
<h1>ğŸ“Š Week of <span id="wk-date"></span></h1>
<div class="card"><h3>ğŸ¯ Weekly Targets</h3>
<div class="hrow"><span class="label l-gym">Gym</span><div class="hinfo"><b>5x</b> â€” <span id="wk-gym">0</span>/5</div></div>
<div class="hrow"><span class="label l-ital">Anki</span><div class="hinfo"><b>Daily 300 (7/7)</b> â€” <span id="wk-anki">0</span>/7</div></div>
<div class="hrow"><span class="label l-ital">Articles</span><div class="hinfo"><b>2/day (14/wk)</b> â€” <span id="wk-art">0</span>/14</div></div>
<div class="hrow"><span class="label l-ital">Conversation</span><div class="hinfo"><b>2x/week</b> â€” <span id="wk-convo">0</span>/2</div></div>
<div class="hrow"><span class="label l-ital">Reflection</span><div class="hinfo"><b>Daily (7/7)</b> â€” <span id="wk-refl">0</span>/7</div></div>
<div class="hrow"><span class="label l-diss">Dissertation</span><div class="hinfo"><b>10hr min</b> â€” <span id="wk-diss">0</span>hr</div></div>
<div class="hrow"><span class="label l-social">Social</span><div class="hinfo"><b>1 event/person</b> â€” <span id="wk-soc">0</span>/1</div></div>
</div>
<div class="card"><h3>ğŸ“ Custom Weekly Goals</h3><div id="cw-goals"></div><div class="flex mt8"><input class="fin flex-1" id="cw-in" placeholder="Custom goal..." onkeydown="if(event.key==='Enter')addCWG()"><select id="cw-cat" class="btn"><option value="work">Work</option><option value="dissertation">Diss.</option><option value="italian">Italian</option><option value="social">Social</option><option value="misc">Misc</option></select><button class="btn btn-s" onclick="addCWG()">Add</button></div></div>
<div class="card"><h3>ğŸ“… Week at a Glance</h3><div id="wk-glance" style="font-size:13px">
<table style="width:100%;border-collapse:collapse;font-size:12px"><thead><tr><th style="padding:4px;border:1px solid var(--border)">Day</th><th style="padding:4px;border:1px solid var(--border)">Morning</th><th style="padding:4px;border:1px solid var(--border)">Work</th><th style="padding:4px;border:1px solid var(--border)">Evening</th></tr></thead><tbody>
<tr><td style="padding:4px;border:1px solid var(--border);font-weight:600">Mon</td><td style="padding:4px;border:1px solid var(--border)"><span class="label l-ital">Italian 7am</span> â†’ <span class="label l-diss">Thesis 2hr</span></td><td style="padding:4px;border:1px solid var(--border)"><span class="label l-work">9-5</span></td><td style="padding:4px;border:1px solid var(--border)">Anki + Articles</td></tr>
<tr><td style="padding:4px;border:1px solid var(--border);font-weight:600">Tue</td><td style="padding:4px;border:1px solid var(--border)"><span class="label l-gym">Gym</span></td><td style="padding:4px;border:1px solid var(--border)"><span class="label l-work">9-5</span></td><td style="padding:4px;border:1px solid var(--border)">Anki + Articles + <span class="label l-diss">Thesis</span></td></tr>
<tr><td style="padding:4px;border:1px solid var(--border);font-weight:600">Wed</td><td style="padding:4px;border:1px solid var(--border)"><span class="label l-gym">Gym</span></td><td style="padding:4px;border:1px solid var(--border)"><span class="label l-work">9-5</span></td><td style="padding:4px;border:1px solid var(--border)">Anki + Articles</td></tr>
<tr><td style="padding:4px;border:1px solid var(--border);font-weight:600">Thu</td><td style="padding:4px;border:1px solid var(--border)"><span class="label l-gym">Gym</span></td><td style="padding:4px;border:1px solid var(--border)"><span class="label l-work">9-5</span></td><td style="padding:4px;border:1px solid var(--border)">Anki + Articles + <span class="label l-diss">Thesis</span></td></tr>
<tr><td style="padding:4px;border:1px solid var(--border);font-weight:600">Fri</td><td style="padding:4px;border:1px solid var(--border)"><span class="label l-ital">Italian 7am</span> â†’ <span class="label l-diss">Thesis 2hr</span></td><td style="padding:4px;border:1px solid var(--border)"><span class="label l-work">9-5</span></td><td style="padding:4px;border:1px solid var(--border)">Free / <span class="label l-social">Social</span></td></tr>
<tr><td style="padding:4px;border:1px solid var(--border);font-weight:600">Sat</td><td style="padding:4px;border:1px solid var(--border)"><span class="label l-gym">Gym</span> + <span class="label l-diss">Thesis 3hr</span></td><td style="padding:4px;border:1px solid var(--border)">â€”</td><td style="padding:4px;border:1px solid var(--border)">Anki + Articles + <span class="label l-social">Social</span></td></tr>
<tr><td style="padding:4px;border:1px solid var(--border);font-weight:600">Sun</td><td style="padding:4px;border:1px solid var(--border)"><span class="label l-gym">Gym</span> + <span class="label l-diss">Thesis 3hr</span></td><td style="padding:4px;border:1px solid var(--border)">â€”</td><td style="padding:4px;border:1px solid var(--border)">Anki + Articles + Weekly Review</td></tr>
</tbody></table></div></div>
<div class="card"><h3>ğŸ” Weekly Review</h3><p style="font-size:12px;color:var(--muted);margin-bottom:8px">Complete all prompts to unlock next week's planning.</p>
<div class="rprompt"><label>What went well this week?</label><textarea id="wr-well" class="fin"></textarea></div>
<div class="rprompt"><label>What didn't go as planned?</label><textarea id="wr-bad" class="fin"></textarea></div>
<div class="rprompt"><label>What's the #1 thing to improve next week?</label><textarea id="wr-imp" class="fin"></textarea></div>
<div class="rprompt"><label>Push Goal result â€” did you complete it? Evidence:</label><textarea id="wr-push" class="fin"></textarea></div>
<button class="btn btn-p mt8" onclick="submitWR()">Submit Weekly Review</button>
<div id="wr-res" class="mt8" style="display:none"></div>
</div>
</div>

<!-- HABITS -->
<div class="tab" id="tab-habits">
<h1>ğŸ”¥ Habit Tracker</h1>
<div id="habit-grids"></div>
<div class="card"><h3>ğŸ›¡ Failure Mode If-Thens</h3><p style="font-size:12px;color:var(--muted);margin-bottom:6px">Pre-register what you'll do when things go wrong.</p><div id="ifthen-list"></div><div class="flex mt8"><input class="fin flex-1" id="ift-in" placeholder="If I miss [X], then I will [Y]..." onkeydown="if(event.key==='Enter')addIFT()"><button class="btn btn-s" onclick="addIFT()">Add</button></div></div>
</div>

<!-- DISSERTATION -->
<div class="tab" id="tab-dissertation">
<h1>ğŸ“ Dissertation</h1>
<div class="card"><h3>ğŸ“Š Overall Progress</h3><div class="pbar"><div class="pfill" id="diss-pbar" style="width:0%"></div></div><p style="font-size:12px;color:var(--muted)" id="diss-total">0 / 0 words</p></div>
<div class="card"><h3>ğŸ“‘ Chapter Outline</h3><div id="ch-list"></div><div class="flex mt8"><input class="fin" id="ch-name" placeholder="Chapter/section name" style="width:200px"><input type="number" class="fin" id="ch-target" placeholder="Target words" style="width:120px"><button class="btn btn-s" onclick="addCh()">Add Chapter</button></div></div>
<div class="card"><h3>â± Deep Work Timer</h3><p style="font-size:12px;color:var(--muted);margin-bottom:8px">90-min blocks with forced break. Pauses when tab is hidden. Only logged time counts.</p>
<div class="timer-d" id="diss-timer">00:00:00</div>
<p style="text-align:center;font-size:12px;color:var(--muted)" id="diss-timer-status">Ready</p>
<div class="timer-c mt8">
<button class="pri" id="diss-start" onclick="dissTimer('start')">â–¶ Start 90min</button>
<button id="diss-5min" onclick="dissTimer('5min')">Just 5 Minutes</button>
<button class="dan" id="diss-stop" onclick="dissTimer('stop')" disabled>â¹ Stop & Log</button>
</div>
<div class="mt8"><select class="fin" id="diss-ch-sel"><option value="">Working on...</option></select></div>
</div>
<div class="card"><h3>ğŸ“‹ Session Log</h3><div id="diss-log" style="max-height:300px;overflow-y:auto"></div></div>
</div>

<!-- INBOX -->
<div class="tab" id="tab-inbox">
<h1>ğŸ“¥ Inbox</h1>
<div class="card"><h3>Capture</h3><div class="iinput"><input id="inbox-in" placeholder="Add task, thought, or idea..." onkeydown="if(event.key==='Enter')addInbox()"><button onclick="addInbox()">Add</button></div></div>
<div class="card"><h3>Unsorted</h3><div id="inbox-unsorted"></div></div>
<div class="card"><h3>Scheduled</h3><div id="inbox-scheduled"></div></div>
<div class="card"><h3>Someday/Maybe</h3><div id="inbox-someday"></div></div>
</div>

<!-- FOCUS -->
<div class="tab" id="tab-focus">
<h1>ğŸ”’ Focus Mode</h1>
<div class="card"><h3>â± Focus Timer</h3>
<div class="timer-d" id="focus-timer">25:00</div>
<p style="text-align:center;font-size:12px;color:var(--muted)" id="focus-status">Pomodoro â€” 25 min</p>
<div class="timer-c mt8">
<button class="pri" onclick="focusTimer('start')">â–¶ Start</button>
<button onclick="focusTimer('pause')">â¸ Pause</button>
<button class="dan" onclick="focusTimer('reset')">â†º Reset</button>
</div>
<div class="flex mt8" style="justify-content:center"><button class="btn btn-s" onclick="setFocus(25)">25min</button><button class="btn btn-s" onclick="setFocus(50)">50min</button><button class="btn btn-s" onclick="setFocus(90)">90min</button></div>
</div>
<div class="card"><h3>ğŸ“µ Distraction Log</h3><p style="font-size:12px;color:var(--muted);margin-bottom:6px">Each time you catch yourself getting distracted, log it here. Awareness is the first step.</p><div id="distraction-log"></div><div class="flex mt8"><input class="fin flex-1" id="dist-in" placeholder="What distracted you?" onkeydown="if(event.key==='Enter')addDist()"><button class="btn btn-s" onclick="addDist()">Log</button></div></div>
<div class="card"><h3>ğŸ§  Energy Level</h3><p style="font-size:12px;color:var(--muted);margin-bottom:6px">Track your energy to learn your peak hours.</p>
<div class="flex"><select class="fin" id="energy-level" style="width:120px"><option value="5">ğŸ”¥ Peak</option><option value="4">âš¡ High</option><option value="3" selected>ğŸ˜ Medium</option><option value="2">ğŸ˜´ Low</option><option value="1">ğŸ’€ Drained</option></select><button class="btn btn-s" onclick="logEnergy()">Log Now</button></div>
<div id="energy-log" class="mt8" style="font-size:12px"></div></div>
</div>

<!-- CLAUDE -->
<div class="tab" id="tab-claude">
<h1>ğŸ¤– Claude Integration</h1>
<div class="apikey"><b>Anthropic API Key</b> (stored locally only, never sent anywhere except Anthropic)<input type="password" id="api-key" placeholder="sk-ant-..." onchange="saveKey()"></div>
<div class="card"><h3>ğŸ’¬ Chat</h3><p style="font-size:12px;color:var(--muted);margin-bottom:8px">Claude has context about your habits, goals, and progress.</p>
<div class="chatc"><div class="chatm" id="chat-msgs"></div><div class="chatia"><input id="chat-in" placeholder="Ask Claude anything..." onkeydown="if(event.key==='Enter')sendChat()"><button onclick="sendChat()">Send</button></div></div></div>
<div class="card"><h3>ğŸ“ Italian Corrections</h3><p style="font-size:12px;color:var(--muted);margin-bottom:6px">Results from your daily reflection submissions appear here.</p><div id="corrections-area" style="max-height:400px;overflow-y:auto"><p style="color:var(--muted);font-size:13px;font-style:italic">No corrections yet. Submit your daily Italian reflection from the Today tab.</p></div></div>
<div class="card"><h3>ğŸƒ Generated Anki Cards</h3><p style="font-size:12px;color:var(--muted);margin-bottom:6px">Cards follow your C2 ruleset. Copy or download.</p><div id="anki-area"><p style="color:var(--muted);font-size:13px;font-style:italic">No cards generated yet.</p></div><div class="flex mt8"><button class="btn btn-s" onclick="copyAnki()">ğŸ“‹ Copy All Cards</button><button class="btn btn-s" onclick="dlAnki()">â¬‡ Download .txt</button></div></div>
</div>

<!-- CARDS -->
<div class="tab" id="tab-cards">
<h1>ğŸƒ Flashcards</h1>
<div class="card" id="cards-summary">
<div class="flex" style="justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px">
<div><b id="cards-new-remaining" style="color:#3b82f6">0</b> <span style="color:var(--muted);font-size:13px">new</span></div>
<div><b id="cards-learning-ct" style="color:#ef4444">0</b> <span style="color:var(--muted);font-size:13px">learning</span></div>
<div><b id="cards-review-remaining" style="color:#22c55e">0</b> <span style="color:var(--muted);font-size:13px">to review</span></div>
<div><b id="cards-reviewed-today" style="color:#8b5cf6">0</b> <span style="color:var(--muted);font-size:13px">reviewed today</span></div>
<div style="margin-top:8px;font-size:12px;color:var(--muted)">
  <label>New/day: <input type="number" id="cards-new-limit" class="fin" style="width:55px;font-size:12px" value="20" min="1" max="200" onchange="saveCardSettings()"></label>
  <span style="margin-left:8px">Review cap: <b id="cards-review-cap">200</b></span>
</div>
<div id="cards-limit-status" style="margin-top:4px;font-size:12px"></div>
<button class="btn btn-p" onclick="startStudy()">â–¶ Study Now</button>
<button class="btn btn-s" id="cards-add-more-btn" style="display:none" onclick="addMoreCards()">â• Add 5 more new cards</button>
</div>
</div>

<div id="study-area" style="display:none">
<div class="card" style="min-height:200px;text-align:center;position:relative">
<div style="font-size:11px;color:var(--muted);margin-bottom:12px"><span id="study-progress"></span></div>
<div id="study-front" style="font-size:1.4em;padding:20px 10px;cursor:pointer" onclick="flipCard()"></div>
<div id="study-back" style="display:none;padding:16px 10px;border-top:1px dashed var(--border);margin-top:12px">
<div id="study-back-content" style="font-size:1.2em;margin-bottom:16px"></div>
<div class="flex" style="justify-content:center;gap:6px;flex-wrap:wrap">
<button class="btn" style="background:var(--red);color:#fff;border-color:var(--red);min-width:70px" onclick="rateCard(1)">Again<br><span style="font-size:10px">&lt;1min</span></button>
<button class="btn" style="background:var(--orange);color:#fff;border-color:var(--orange);min-width:70px" onclick="rateCard(2)">Hard<br><span style="font-size:10px" id="hard-ivl"></span></button>
<button class="btn" style="background:var(--green);color:#fff;border-color:var(--green);min-width:70px" onclick="rateCard(3)">Good<br><span style="font-size:10px" id="good-ivl"></span></button>
<button class="btn" style="background:var(--blue);color:#fff;border-color:var(--blue);min-width:70px" onclick="rateCard(4)">Easy<br><span style="font-size:10px" id="easy-ivl"></span></button>
</div>
</div>
<p style="font-size:11px;color:var(--muted);margin-top:10px;cursor:pointer" onclick="flipCard()" id="study-hint">tap to flip</p>
</div>
<div style="text-align:center"><button class="btn btn-s" onclick="endStudy()">âœ• End Session</button></div>
</div>

<div class="card"><h3>â• Add Cards</h3>
<div class="mb4"><input class="fin" id="card-front" placeholder="Front (Italian)"></div>
<div class="mb4"><input class="fin" id="card-back" placeholder="Back (English)"></div>
<div class="mb4"><input class="fin" id="card-tags" placeholder="Tags (comma-separated, optional)"></div>
<div class="flex"><button class="btn btn-p" onclick="addCard()">Add Card</button><button class="btn btn-s" onclick="toggleBulkImport()">ğŸ“‹ Bulk Import</button><button id="seed-anki-btn" class="btn btn-s" onclick="seedAnkiDeck()">ğŸ“¦ Seed Anki Deck</button></div>
<div id="bulk-import" style="display:none" class="mt8">
<p style="font-size:12px;color:var(--muted);margin-bottom:4px">Paste TSV (frontâ†’back, one per line) or Front: / Back: pairs:</p>
<textarea class="fin" id="bulk-text" rows="6" placeholder="word1&#9;meaning1&#10;word2&#9;meaning2&#10;&#10;OR:&#10;&#10;Front: parola&#10;Back: word"></textarea>
<button class="btn btn-p mt8" onclick="bulkImport()">Import</button>
</div>
</div>

<div class="card"><h3>ğŸ“‹ Pending Cards from Reflections</h3>
<p style="font-size:12px;color:var(--muted);margin-bottom:6px">Cards generated by Claude from your Italian reflections. Review and add to your deck.</p>
<div id="pending-cards"></div>
</div>

<div class="card"><h3>ğŸ” Browse Deck</h3>
<div class="flex mb8"><input class="fin flex-1" id="card-search" placeholder="Search cards..." oninput="renderCardBrowse()"><select class="fin" id="card-filter" onchange="renderCardBrowse()" style="width:120px"><option value="all">All</option><option value="new">New</option><option value="learning">Learning</option><option value="review">Review</option><option value="due">Due</option></select></div>
<div id="card-browse" style="max-height:400px;overflow-y:auto"></div>
</div>
</div>

<!-- TRANSLATE / READ -->
<div class="tab" id="tab-translate">
<h1>ğŸ‡®ğŸ‡¹ Italian Reading</h1>
<div class="card">
<h3>ğŸ“° Fetch & Translate Article</h3>
<p style="font-size:12px;color:var(--muted);margin-bottom:8px">Paste an Italian article URL or text. Claude will produce a side-by-side translation. Select any Italian word/phrase to create a flashcard.</p>
<div class="flex mb8">
<input class="fin flex-1" id="tr-url" placeholder="Paste URL (e.g. from Corriere, Repubblica, Internazionale...)">
<button class="btn btn-p" onclick="trFetchURL()">Fetch & Translate</button>
</div>
<details class="mb8"><summary style="cursor:pointer;font-size:13px;color:var(--muted)">Or paste text directly</summary>
<textarea class="fin mt8" id="tr-raw" rows="6" placeholder="Paste Italian article text here..."></textarea>
<button class="btn btn-p mt8" onclick="trTranslateRaw()">Translate</button>
</details>
<div id="tr-status" style="font-size:12px;color:var(--muted);margin-top:4px"></div>
</div>

<div class="card" id="tr-result-card" style="display:none">
<h3 id="tr-title" style="margin-bottom:4px"></h3>
<p style="font-size:11px;color:var(--muted);margin-bottom:10px" id="tr-meta"></p>
<div style="overflow-x:auto">
<table class="tr-table" id="tr-table">
<thead><tr><th style="width:50%">ğŸ‡®ğŸ‡¹ Italiano</th><th style="width:50%">ğŸ‡¬ğŸ‡§ English</th></tr></thead>
<tbody id="tr-tbody"></tbody>
</table>
</div>
<p style="font-size:11px;color:var(--muted);margin-top:10px">ğŸ’¡ Highlight any Italian word or phrase to collect it for flashcards.</p>
</div>

<div class="card" id="tr-reflection-card" style="display:none">
<h3>âœï¸ Reflection (in Italian)</h3>
<p style="font-size:12px;color:var(--muted);margin-bottom:8px">Write a short reflection about this article in Italian. Minimum 50 words.</p>
<div class="rarea"><textarea id="tr-refl-txt" placeholder="Scrivi una riflessione su questo articolo..." oninput="trUpdReflWC()"></textarea></div>
<div class="wc" id="tr-refl-wc">0 / 50 words</div>
<div class="flex mt8" style="gap:8px;flex-wrap:wrap;align-items:center">
<span style="font-size:12px;color:var(--muted)">Log as:</span>
<button class="btn btn-p" onclick="trSubmitReflection(1)">âœ… Submit as Article 1</button>
<button class="btn btn-p" onclick="trSubmitReflection(2)">âœ… Submit as Article 2</button>
</div>
<div id="tr-refl-status" style="font-size:12px;color:var(--muted);margin-top:6px"></div>
<div id="tr-refl-result" style="display:none;margin-top:10px" class="card" >
<h4 style="font-size:13px;margin-bottom:6px">ğŸ“ Claude's Feedback</h4>
<div id="tr-refl-feedback"></div>
</div>
<div id="tr-refl-card-review" style="display:none;margin-top:10px" class="card"></div>
</div>

<div class="card" id="tr-collected-card" style="display:none">
<h3>ğŸƒ Collected Words (<span id="tr-coll-ct">0</span>)</h3>
<p style="font-size:12px;color:var(--muted);margin-bottom:8px">Words you highlighted while reading. Submit them all at once below.</p>
<div class="flex mb8">
<button class="btn btn-p" onclick="trSubmitWords()">ğŸ¤– Auto-translate All & Create Cards</button>
<button class="btn btn-s" onclick="trClearCollected()">Clear All</button>
</div>
<div id="tr-words-status" style="font-size:12px;color:var(--muted);margin-bottom:6px"></div>
<div id="tr-collected-list"></div>
<div id="tr-words-card-review" style="display:none;margin-top:10px" class="card"></div>
</div>

<div class="card">
<h3>ğŸ“š Reading History</h3>
<div id="tr-history" style="max-height:300px;overflow-y:auto"></div>
</div>
</div>

<!-- LOG -->
<div class="tab" id="tab-log">
<h1>ğŸ“‹ Activity Log</h1>
<div class="card"><h3>ğŸ” Filter</h3><div class="flex"><select class="fin" id="log-filter" onchange="renderLog()" style="width:150px"><option value="all">All</option><option value="action">Actions</option><option value="warning">Warnings</option><option value="sealed">Sealed Days</option><option value="confession">Confessions</option></select><input type="date" class="fin" id="log-date-filter" onchange="renderLog()" style="width:150px"></div></div>
<div class="card"><h3>ğŸ“– Confession / Note</h3><div class="flex"><textarea class="fin flex-1" id="confess-in" placeholder="Honest note to future self..." rows="2"></textarea><button class="btn btn-s" onclick="addConfession()">Log</button></div></div>
<div id="log-entries" style="max-height:500px;overflow-y:auto"></div>
<div class="card mt8" style="text-align:center"><button class="btn btn-s" onclick="exportData()">â¬‡ Export All Data (JSON)</button><span style="margin:0 8px">|</span><label class="btn btn-s" style="display:inline-block">â¬† Import Data <input type="file" accept=".json" onchange="importData(event)" style="display:none"></label></div>
</div>

<!-- Firebase SDK (compat for simple script-tag usage) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
<script src="firebase-sync.js"></script>
<script src="app.js"></script>
<script>
// Initialize Firebase Sync after app loads
FirebaseSync.init();

// Show disconnect button if already connected
if (FirebaseSync.isConnected()) {
  document.getElementById('sync-disc').style.display = '';
  document.getElementById('sync-pass').style.display = 'none';
  document.querySelector('.sync-bar .btn-sync').style.display = 'none';
}

function doSync() {
  const p = document.getElementById('sync-pass').value.trim();
  if (!p || p.length < 4) { alert('Passphrase must be at least 4 characters'); return; }
  FirebaseSync.connect(p).then(ok => {
    if (ok) {
      document.getElementById('sync-disc').style.display = '';
      document.getElementById('sync-pass').style.display = 'none';
      document.querySelector('.sync-bar .btn-sync').style.display = 'none';
    }
  });
}

function doDisconnect() {
  if (confirm('Disconnect sync? Data stays on this device but stops syncing.')) {
    FirebaseSync.disconnect();
    document.getElementById('sync-disc').style.display = 'none';
    document.getElementById('sync-pass').style.display = '';
    document.getElementById('sync-pass').value = '';
    document.querySelector('.sync-bar .btn-sync').style.display = '';
  }
}

// Register service worker for PWA
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js').catch(e => console.warn('SW reg failed:', e));
}
</script>
</body>
</html>
